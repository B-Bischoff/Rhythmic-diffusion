<HTML>
<HEAD>
<TITLE>The Synthesis ToolKit in C++ (STK)</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<CENTER>
<img src="princeton.gif"> &nbsp; <img src="ccrma.gif"> &nbsp; <img src="mcgill.gif"><P>
<a class="qindex" href="index.html">Home</a> &nbsp; <a class="qindex" href="information.html">Information</a> &nbsp; <a class="qindex" href="classes.html">Classes</a> &nbsp; <a class="qindex" href="download.html">Download</a> &nbsp; <a class="qindex" href="usage.html">Usage</a> &nbsp; <a class="qindex" href="maillist.html">Mail List</a> &nbsp; <a class="qindex" href="system.html">Requirements</a> &nbsp; <a class="qindex" href="links.html">Links</a> &nbsp; <a class="qindex" href="faq.html">FAQ</a> &nbsp; <a class="qindex" href="tutorial.html">Tutorial</a></CENTER>
<HR>
<!-- Generated by Doxygen 1.8.3.1 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Hello Sine! </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We'll continue our introduction to the Synthesis ToolKit with a simple sine-wave oscillator program. STK provides two different classes for sine-wave generation. We will first look at a generic waveform oscillator class, <a class="el" href="classstk_1_1FileLoop.html" title="STK file looping / oscillator class.">stk::FileLoop</a>, that can load a variety of common file types. In this example, we load a sine "table" from an STK RAW file (defined as monophonic, 16-bit, big-endian data). We use the class <a class="el" href="classstk_1_1FileWvOut.html" title="STK audio file output class.">stk::FileWvOut</a> to write the result to a 16-bit, WAV formatted audio file.</p>
<div class="fragment"><div class="line"><span class="comment">// sineosc.cpp</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;FileLoop.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;FileWvOut.h&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span>stk;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Set the global sample rate before creating class instances.</span></div>
<div class="line">  <a class="code" href="classstk_1_1Stk.html#a46e2f55e5a92c717c3893fe23dde88a5" title="Static method that sets the STK sample rate.">Stk::setSampleRate</a>( 44100.0 );</div>
<div class="line"></div>
<div class="line">  <a class="code" href="classstk_1_1FileLoop.html" title="STK file looping / oscillator class.">FileLoop</a> input;</div>
<div class="line">  <a class="code" href="classstk_1_1FileWvOut.html" title="STK audio file output class.">FileWvOut</a> output;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Load the sine wave file.</span></div>
<div class="line">  input.<a class="code" href="classstk_1_1FileLoop.html#a85cec06a7ea6562bd622efdad07ce7e5" title="Open the specified file and load its data.">openFile</a>( <span class="stringliteral">&quot;rawwaves/sinewave.raw&quot;</span>, <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Open a 16-bit, one-channel WAV formatted output file</span></div>
<div class="line">  output.<a class="code" href="classstk_1_1FileWvOut.html#a31dde577d41a65018c3e03001de8d645" title="Open a new file with the specified parameters.">openFile</a>( <span class="stringliteral">&quot;hellosine.wav&quot;</span>, 1, <a class="code" href="classstk_1_1FileWrite.html#a800875bbcac8f137ed94f5606d55f8c6">FileWrite::FILE_WAV</a>, <a class="code" href="classstk_1_1Stk.html#a5a807971b7fc3c8985d97823be079a7b">Stk::STK_SINT16</a> );</div>
<div class="line"></div>
<div class="line">  input.<a class="code" href="classstk_1_1FileLoop.html#aec8f94d8514b266acd83106ed0f24ead" title="Set the data interpolation rate based on a looping frequency.">setFrequency</a>( 440.0 );</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Run the oscillator for 40000 samples, writing to the output file</span></div>
<div class="line">  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;40000; i++ )</div>
<div class="line">    output.<a class="code" href="classstk_1_1FileWvOut.html#a9d3505aea3cd3c4d6822f05a2679dc41" title="Output a single sample to all channels in a sample frame.">tick</a>( input.<a class="code" href="classstk_1_1FileLoop.html#a037b31918134ed1839a8b48de774ab95" title="Compute a sample frame and return the specified channel value.">tick</a>() );</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="el" href="classstk_1_1FileLoop.html" title="STK file looping / oscillator class.">stk::FileLoop</a> is a subclass of <a class="el" href="classstk_1_1FileWvIn.html" title="STK audio file input class.">stk::FileWvIn</a>, which supports WAV, SND (AU), AIFF, MAT-file (Matlab), and RAW file formats with 8-, 16-, and 32-bit integer and 32- and 64-bit floating-point data types. <a class="el" href="classstk_1_1FileWvIn.html" title="STK audio file input class.">stk::FileWvIn</a> provides interpolating, read-once ("oneshot") functionality, as well as methods for setting the read rate and read position.</p>
<p><a class="el" href="classstk_1_1FileWvIn.html" title="STK audio file input class.">stk::FileWvIn</a> provides a "tick level" and interpolating interface to the <a class="el" href="classstk_1_1FileRead.html" title="STK audio file input class.">stk::FileRead</a> class. Likewise, <a class="el" href="classstk_1_1FileWvOut.html" title="STK audio file output class.">stk::FileWvOut</a> provides a "tick
level" interface to the <a class="el" href="classstk_1_1FileWrite.html" title="STK audio file output class.">stk::FileWrite</a> class. <a class="el" href="classstk_1_1FileRead.html" title="STK audio file input class.">stk::FileRead</a> and FileWrite both support WAV, SND(AU), AIFF, MAT-file (Matlab), and RAW file formats with 8-, 16-, and 32-bit integer and 32- and 64-bit floating-point data types. <a class="el" href="classstk_1_1FileWvOut.html" title="STK audio file output class.">stk::FileWvOut</a> does not currently offer data interpolation functionality.</p>
<p>A number of STK parent classes, including <a class="el" href="classstk_1_1WvIn.html" title="STK audio input abstract base class.">stk::WvIn</a>, <a class="el" href="classstk_1_1WvOut.html" title="STK audio output abstract base class.">stk::WvOut</a>, <a class="el" href="classstk_1_1Instrmnt.html" title="STK instrument abstract base class.">stk::Instrmnt</a>, <a class="el" href="classstk_1_1Generator.html" title="STK abstract unit generator parent class.">stk::Generator</a>, and <a class="el" href="classstk_1_1Effect.html" title="STK abstract effects parent class.">stk::Effect</a>, (and some or all of their subclasses) support multi-channel sample frames. If a single-sample version of the <code>tick()</code> function is called for these classes, a full sample frame is computed but only a single value is either input and/or output. For example, if the single-sample <code>tick()</code> function is called for subclasses of <a class="el" href="classstk_1_1WvOut.html" title="STK audio output abstract base class.">stk::WvOut</a>, the sample argument is written to all channels in the one computed frame. For classes returning values, an optional <code>channel</code> argument specifies which channel value is returned from the computed frame (the default is always channel 0). To input and/or output multichannel data to these classes, the overloaded <code>tick()</code> functions taking StkFrames reference arguments should be used.</p>
<p>Nearly all STK classes inherit from the <a class="el" href="classstk_1_1Stk.html" title="STK base class.">stk::Stk</a> base class. Stk provides a static sample rate that is queried by subclasses as needed. Because many classes use the current sample rate value during instantiation, it is important that the desired value be set at the beginning of a program. The default STK sample rate is 44100 Hz.</p>
<h1><a class="anchor" id="error"></a>
Error Handling</h1>
<p>The ToolKit has some basic C++ error handling functionality built in. Classes that access files and/or hardware are most prone to runtime errors. To properly "catch" such errors, the above example should be rewritten as shown below.</p>
<div class="fragment"><div class="line"><span class="comment">// sineosc.cpp STK tutorial program</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;FileLoop.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;FileWvOut.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span>stk;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Set the global sample rate before creating class instances.</span></div>
<div class="line">  <a class="code" href="classstk_1_1Stk.html#a46e2f55e5a92c717c3893fe23dde88a5" title="Static method that sets the STK sample rate.">Stk::setSampleRate</a>( 44100.0 );</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> nFrames = 100000;</div>
<div class="line">  <a class="code" href="classstk_1_1FileLoop.html" title="STK file looping / oscillator class.">FileLoop</a> input;</div>
<div class="line">  <a class="code" href="classstk_1_1FileWvOut.html" title="STK audio file output class.">FileWvOut</a> output;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <span class="comment">// Load the sine wave file.</span></div>
<div class="line">    input.<a class="code" href="classstk_1_1FileLoop.html#a85cec06a7ea6562bd622efdad07ce7e5" title="Open the specified file and load its data.">openFile</a>( <span class="stringliteral">&quot;rawwaves/sinewave.raw&quot;</span>, <span class="keyword">true</span> );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Open a 16-bit, one-channel WAV formatted output file</span></div>
<div class="line">    output.<a class="code" href="classstk_1_1FileWvOut.html#a31dde577d41a65018c3e03001de8d645" title="Open a new file with the specified parameters.">openFile</a>( <span class="stringliteral">&quot;hellosine.wav&quot;</span>, 1, <a class="code" href="classstk_1_1FileWrite.html#a800875bbcac8f137ed94f5606d55f8c6">FileWrite::FILE_WAV</a>, <a class="code" href="classstk_1_1Stk.html#a5a807971b7fc3c8985d97823be079a7b">Stk::STK_SINT16</a> );</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> ( <a class="code" href="classstk_1_1StkError.html" title="STK error handling class.">StkError</a> &amp; ) {</div>
<div class="line">    exit( 1 );</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  input.<a class="code" href="classstk_1_1FileLoop.html#aec8f94d8514b266acd83106ed0f24ead" title="Set the data interpolation rate based on a looping frequency.">setFrequency</a>( 440.0 );</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Option 1: Use StkFrames</span></div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">  StkFrames frames( nFrames, 1 );</span></div>
<div class="line"><span class="comment">  try {</span></div>
<div class="line"><span class="comment">    output.tick( input.tick( frames ) );</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  catch ( StkError &amp; ) {</span></div>
<div class="line"><span class="comment">    exit( 1 );</span></div>
<div class="line"><span class="comment">  }</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Option 2: Single-sample computations</span></div>
<div class="line">  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;nFrames; i++ ) {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">      output.<a class="code" href="classstk_1_1FileWvOut.html#a9d3505aea3cd3c4d6822f05a2679dc41" title="Output a single sample to all channels in a sample frame.">tick</a>( input.<a class="code" href="classstk_1_1FileLoop.html#a037b31918134ed1839a8b48de774ab95" title="Compute a sample frame and return the specified channel value.">tick</a>() );</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> ( <a class="code" href="classstk_1_1StkError.html" title="STK error handling class.">StkError</a> &amp; ) {</div>
<div class="line">      exit( 1 );</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>In this particular case, we simply exit the program if an error occurs (an error message is automatically printed to stderr). A more refined program might attempt to recover from or fix a particular problem and, if successful, continue processing. See the <a class="el" href="classes.html">Class Documentation</a> to determine which constructors and functions can throw an error.</p>
<p>[<a href="fundamentals.html">Main tutorial page</a>] &#160; [<a href="compile.html">Next tutorial</a>] </p>
</div></div><!-- contents -->
<HR>
<table>
  <tr><td><A HREF="http://ccrma.stanford.edu/software/stk/"><I>The Synthesis ToolKit in C++ (STK)</I></A></td></tr>
  <tr><td>&copy;1995--2021 Perry R. Cook and Gary P. Scavone. All Rights Reserved.</td></tr>
</table>
</BODY>
</HTML>
