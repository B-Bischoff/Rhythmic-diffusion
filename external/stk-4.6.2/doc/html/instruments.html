<HTML>
<HEAD>
<TITLE>The Synthesis ToolKit in C++ (STK)</TITLE>
<LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
</HEAD>
<BODY BGCOLOR="#FFFFFF">
<CENTER>
<img src="princeton.gif"> &nbsp; <img src="ccrma.gif"> &nbsp; <img src="mcgill.gif"><P>
<a class="qindex" href="index.html">Home</a> &nbsp; <a class="qindex" href="information.html">Information</a> &nbsp; <a class="qindex" href="classes.html">Classes</a> &nbsp; <a class="qindex" href="download.html">Download</a> &nbsp; <a class="qindex" href="usage.html">Usage</a> &nbsp; <a class="qindex" href="maillist.html">Mail List</a> &nbsp; <a class="qindex" href="system.html">Requirements</a> &nbsp; <a class="qindex" href="links.html">Links</a> &nbsp; <a class="qindex" href="faq.html">FAQ</a> &nbsp; <a class="qindex" href="tutorial.html">Tutorial</a></CENTER>
<HR>
<!-- Generated by Doxygen 1.8.3.1 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Instruments </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The ToolKit comes with a wide variety of synthesis algorithms, all of which inherit from the <a class="el" href="classstk_1_1Instrmnt.html" title="STK instrument abstract base class.">stk::Instrmnt</a> class. In this example, we'll fire up an instance of the <a class="el" href="classstk_1_1BeeThree.html" title="STK Hammond-oid organ FM synthesis instrument.">stk::BeeThree</a> FM synthesis class and show how its frequency can be modified over time.</p>
<div class="fragment"><div class="line"><span class="comment">// bethree.cpp STK tutorial program</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;BeeThree.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="RtAudio_8h.html">RtAudio.h</a>&quot;</span></div>
<div class="line"><span class="keyword">using namespace </span>stk;</div>
<div class="line"></div>
<div class="line"><span class="comment">// The TickData structure holds all the class instances and data that</span></div>
<div class="line"><span class="comment">// are shared by the various processing functions.</span></div>
<div class="line"><span class="keyword">struct </span>TickData {</div>
<div class="line">  <a class="code" href="classstk_1_1Instrmnt.html" title="STK instrument abstract base class.">Instrmnt</a> *instrument;</div>
<div class="line">  StkFloat frequency;</div>
<div class="line">  StkFloat scaler;</div>
<div class="line">  <span class="keywordtype">long</span> counter;</div>
<div class="line">  <span class="keywordtype">bool</span> done;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Default constructor.</span></div>
<div class="line">  TickData()</div>
<div class="line">    : instrument(0), scaler(1.0), counter(0), done( false ) {}</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">// This tick() function handles sample computation only.  It will be</span></div>
<div class="line"><span class="comment">// called automatically when the system needs a new buffer of audio</span></div>
<div class="line"><span class="comment">// samples.</span></div>
<div class="line"><span class="keywordtype">int</span> tick( <span class="keywordtype">void</span> *outputBuffer, <span class="keywordtype">void</span> *inputBuffer, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nBufferFrames,</div>
<div class="line">         <span class="keywordtype">double</span> streamTime, <a class="code" href="RtAudio_8h.html#a80e306d363583da3b0a1b65d9b57c806" title="RtAudio stream status (over- or underflow) flags.">RtAudioStreamStatus</a> status, <span class="keywordtype">void</span> *userData )</div>
<div class="line">{</div>
<div class="line">  TickData *data = (TickData *) userData;</div>
<div class="line">  <span class="keyword">register</span> StkFloat *samples = (StkFloat *) outputBuffer;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nBufferFrames; i++ ) {</div>
<div class="line">    *samples++ = data-&gt;instrument-&gt;tick();</div>
<div class="line">    <span class="keywordflow">if</span> ( ++data-&gt;counter % 2000 == 0 ) {</div>
<div class="line">      data-&gt;scaler += 0.025;</div>
<div class="line">      data-&gt;instrument-&gt;setFrequency( data-&gt;frequency * data-&gt;scaler );</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> ( data-&gt;counter &gt; 80000 )</div>
<div class="line">    data-&gt;done = <span class="keyword">true</span>;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Set the global sample rate and rawwave path before creating class instances.</span></div>
<div class="line">  <a class="code" href="classstk_1_1Stk.html#a46e2f55e5a92c717c3893fe23dde88a5" title="Static method that sets the STK sample rate.">Stk::setSampleRate</a>( 44100.0 );</div>
<div class="line">  <a class="code" href="classstk_1_1Stk.html#a4f641ad194f9d8ce1f9d1ae56af5686b" title="Static method that sets the STK rawwave path.">Stk::setRawwavePath</a>( <span class="stringliteral">&quot;../../rawwaves/&quot;</span> );</div>
<div class="line"></div>
<div class="line">  TickData data;</div>
<div class="line">  <a class="code" href="classRtAudio.html" title="Realtime audio i/o C++ classes.">RtAudio</a> dac;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Figure out how many bytes in an StkFloat and setup the RtAudio stream.</span></div>
<div class="line">  <a class="code" href="structRtAudio_1_1StreamParameters.html" title="The structure for specifying input or output stream parameters.">RtAudio::StreamParameters</a> parameters;</div>
<div class="line">  parameters.<a class="code" href="structRtAudio_1_1StreamParameters.html#ab3c72bcf3ef12149ae9a4fb597cc5489">deviceId</a> = dac.<a class="code" href="classRtAudio.html#a3a3f3dbe13ea696b521e49cdaaa357bc" title="A function that returns the index of the default output device.">getDefaultOutputDevice</a>();</div>
<div class="line">  parameters.<a class="code" href="structRtAudio_1_1StreamParameters.html#a88a10091b6e284e21235cc6f25332ebd">nChannels</a> = 1;</div>
<div class="line">  <a class="code" href="RtAudio_8h.html#aafca92882d25915560018873221e44b8" title="RtAudio data format type.">RtAudioFormat</a> format = ( <span class="keyword">sizeof</span>(StkFloat) == 8 ) ? RTAUDIO_FLOAT64 : RTAUDIO_FLOAT32;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bufferFrames = RT_BUFFER_SIZE;</div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    dac.<a class="code" href="classRtAudio.html#a6907539d2527775df778ebce32ef1e3b" title="A public function for opening a stream with the specified parameters.">openStream</a>( &amp;parameters, NULL, format, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="classstk_1_1Stk.html#a5fbe37000a611ce56075ee7d8936472d" title="Static method that returns the current STK sample rate.">Stk::sampleRate</a>(), &amp;bufferFrames, &amp;tick, (<span class="keywordtype">void</span> *)&amp;data );</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> ( <a class="code" href="classRtAudioError.html" title="Exception handling class for RtAudio.">RtAudioError</a>&amp; error ) {</div>
<div class="line">    error.<a class="code" href="classRtAudioError.html#a0124bb90075cf3201865a0ea9b43a826" title="Prints thrown error message to stderr.">printMessage</a>();</div>
<div class="line">    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    <span class="comment">// Define and load the BeeThree instrument</span></div>
<div class="line">    data.instrument = <span class="keyword">new</span> <a class="code" href="classstk_1_1BeeThree.html" title="STK Hammond-oid organ FM synthesis instrument.">BeeThree</a>();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> ( <a class="code" href="classstk_1_1StkError.html" title="STK error handling class.">StkError</a> &amp; ) {</div>
<div class="line">    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  data.frequency = 220.0;</div>
<div class="line">  data.instrument-&gt;noteOn( data.frequency, 0.5 );</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    dac.<a class="code" href="classRtAudio.html#aec017a89629ccef66a90b60be22a2f80" title="A function that starts a stream.">startStream</a>();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> ( <a class="code" href="classRtAudioError.html" title="Exception handling class for RtAudio.">RtAudioError</a> &amp;error ) {</div>
<div class="line">    error.<a class="code" href="classRtAudioError.html#a0124bb90075cf3201865a0ea9b43a826" title="Prints thrown error message to stderr.">printMessage</a>();</div>
<div class="line">    <span class="keywordflow">goto</span> cleanup;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Block waiting until callback signals done.</span></div>
<div class="line">  <span class="keywordflow">while</span> ( !data.done )</div>
<div class="line">    <a class="code" href="classstk_1_1Stk.html#ad75619ab92a0c19b5a52cb68884511e3" title="Static cross-platform method to sleep for a number of milliseconds.">Stk::sleep</a>( 100 );</div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Shut down the callback and output stream.</span></div>
<div class="line">  <span class="keywordflow">try</span> {</div>
<div class="line">    dac.<a class="code" href="classRtAudio.html#a90d599002ad32cf250a4cb866f2cc93a" title="A function that closes a stream and frees any associated stream memory.">closeStream</a>();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">catch</span> ( <a class="code" href="classRtAudioError.html" title="Exception handling class for RtAudio.">RtAudioError</a> &amp;error ) {</div>
<div class="line">    error.<a class="code" href="classRtAudioError.html#a0124bb90075cf3201865a0ea9b43a826" title="Prints thrown error message to stderr.">printMessage</a>();</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"> cleanup:</div>
<div class="line">  <span class="keyword">delete</span> data.instrument;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>We have used an Instrmnt pointer when referencing the BeeThree instance above, so it would be simple to replace the BeeThree class with any other STK instrument class. It should be noted, however, that a few classes do not respond to the setFrequency() function (e.g., Shakers, Drummer).</p>
<p>The noteOn() function initiates an instrument attack. Instruments that are continuously excited (e.g., <a class="el" href="classstk_1_1Clarinet.html" title="STK clarinet physical model class.">stk::Clarinet</a>, <a class="el" href="classstk_1_1BeeThree.html" title="STK Hammond-oid organ FM synthesis instrument.">stk::BeeThree</a>) will continue to sound until stopped with a noteOff(). Impulsively excited instrument sounds (e.g., <a class="el" href="classstk_1_1Plucked.html" title="STK basic plucked string class.">stk::Plucked</a>, <a class="el" href="classstk_1_1Wurley.html" title="STK Wurlitzer electric piano FM synthesis instrument.">stk::Wurley</a>) typically decay within a few seconds time, requiring subsequent noteOn() messages for re-attack.</p>
<p>Instrument parameters can be precisely controlled as demonstrated above. A more flexible approach to instrument control, allowing arbitrary scorefile or realtime updates, is described in the next tutorial chapter.</p>
<p>[<a href="tutorial.html">Main tutorial page</a>] &#160; [<a href="controlin.html">Next tutorial</a>] </p>
</div></div><!-- contents -->
<HR>
<table>
  <tr><td><A HREF="http://ccrma.stanford.edu/software/stk/"><I>The Synthesis ToolKit in C++ (STK)</I></A></td></tr>
  <tr><td>&copy;1995--2021 Perry R. Cook and Gary P. Scavone. All Rights Reserved.</td></tr>
</table>
</BODY>
</HTML>
